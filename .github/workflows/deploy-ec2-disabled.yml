# EC2ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆç„¡åŠ¹åŒ–æ¸ˆã¿ï¼‰
# Cloud Runã¸ã®ç§»è¡Œã«ã‚ˆã‚Šç„¡åŠ¹åŒ–
# å±¥æ­´å‚ç…§ç”¨ã¨ã—ã¦ä¿æŒ

name: Deploy to EC2 (DISABLED)

on:
  # è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ã‚’ç„¡åŠ¹åŒ–
  # push:
  #   branches: [main]
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã®ã¿ï¼ˆç·Šæ€¥æ™‚ç”¨ï¼‰
    inputs:
      confirm:
        description: 'Type "confirm" to enable EC2 deployment'
        required: true
        default: ''

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.event.inputs.confirm == 'confirm'  # ç¢ºèªãŒå¿…è¦

    steps:
    - name: Warning Message
      run: |
        echo "âš ï¸  WARNING: EC2 deployment is disabled"
        echo "ğŸ’¡ Current deployment: Cloud Run"
        echo "ğŸ“ Setup guide: CLOUD_RUN_SETUP.md"
        exit 1  # å®Ÿè¡Œã‚’åœæ­¢

    # ä»¥ä¸‹ã¯å‚ç…§ç”¨ï¼ˆå®Ÿè¡Œã•ã‚Œãªã„ï¼‰
    - name: Checkout code (DISABLED)
      if: false
      uses: actions/checkout@v3

    - name: Deploy to EC2 (DISABLED)
      if: false
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: 54.206.62.35
        username: ec2-user
        key: ${{ secrets.EC2_SSH_KEY }}
        script: |
          cd /home/ec2-user/streamlit-ad-app
          git pull origin main
          docker stop streamlit-ad-app-container || true
          docker rm streamlit-ad-app-container || true
          docker build -t streamlit-ad-app .
          docker run -d -p 8501:8501 -e ANTHROPIC_API_KEY="${{ secrets.ANTHROPIC_API_KEY }}" --name streamlit-ad-app-container streamlit-ad-app
          echo "Deployment completed successfully"