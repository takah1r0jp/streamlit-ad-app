# 🛡️ セキュリティ手動テストガイド

## 📋 必須テスト項目

### Test 1: マルチブラウザ分離テスト

#### 準備
```bash
streamlit run app/main.py
```

#### 実行手順

**ブラウザA（Chrome）:**
1. http://localhost:8501 にアクセス
2. APIキー入力: `test-api-key-user-A`
3. 画像アップロード: `test_image_A.jpg`
4. 条件設定: "画像に赤いリンゴが2個ある"
5. 「🔍 セキュリティ情報を表示」をチェック
6. session_id_preview をメモ: `___________`

**ブラウザB（Firefox/Safari）:**
1. http://localhost:8501 にアクセス
2. APIキー入力: `test-api-key-user-B`
3. 画像アップロード: `test_image_B.jpg`
4. 条件設定: "画像に青いボールが1個ある"
5. 「🔍 セキュリティ情報を表示」をチェック
6. session_id_preview をメモ: `___________`

#### ✅ 成功基準
- [ ] 異なるsession_id_previewが表示される
- [ ] ブラウザAでブラウザBの画像が表示されない
- [ ] ブラウザAでブラウザBの条件が表示されない
- [ ] 各ブラウザで独立したファイルパスが使用される

### Test 2: APIキー分離テスト

#### 実行手順
1. ブラウザAでプログラム生成を実行
2. ブラウザBでプログラム生成を実行
3. 開発者ツールのコンソールでエラーをチェック

#### ✅ 成功基準
- [ ] 各ブラウザで独立してプログラム生成が成功
- [ ] APIキー関連のエラーが発生しない
- [ ] 環境変数ANTHROPIC_API_KEYが設定されていない（重要）

### Test 3: セッション永続性テスト

#### 実行手順
1. ブラウザAでデータ入力（APIキー、画像、条件）
2. F5でページリロード
3. データが保持されているか確認
4. 新しいタブで同じURLを開く
5. 同じセッションデータが表示されるか確認

#### ✅ 成功基準
- [ ] リロード後もセッションデータが保持される
- [ ] 新しいタブでも同じセッションが継続される
- [ ] セキュリティ初期化エラーが発生しない

### Test 4: ファイル分離テスト

#### 実行手順
1. ブラウザAで画像アップロード
2. セキュリティ情報からファイルパスを確認
3. ブラウザBで画像アップロード
4. セキュリティ情報からファイルパスを確認

#### ✅ 成功基準
- [ ] 異なるディレクトリパスが使用される
- [ ] パスにsession_idが含まれている
- [ ] ファイルが他のセッションからアクセスできない

### Test 5: プログラム生成・実行分離テスト

#### 実行手順
1. **ブラウザA**: プログラム生成→実行→結果確認
2. **ブラウザB**: プログラム生成→実行→結果確認
3. 各ブラウザの「生成されたコード」を比較

#### ✅ 成功基準
- [ ] 異なる条件で異なるコードが生成される
- [ ] 実行結果が混在しない
- [ ] ダウンロードファイルが独立している

## 🚨 セキュリティ違反の兆候

以下の現象が発生した場合、セキュリティ問題があります：

### ❌ 重大な問題
- [ ] 他のユーザーの画像が表示される
- [ ] 他のユーザーのAPIキーが使用される
- [ ] 他のユーザーの生成コードが表示される
- [ ] 同じsession_id_previewが複数ブラウザで表示される

### ⚠️ 注意が必要
- [ ] セッション初期化エラーが頻発する
- [ ] ファイルアップロードが失敗する
- [ ] セキュリティ情報が表示されない

## 📊 テスト結果記録

### 実行日時
日時: _______________

### 環境情報
- OS: _______________
- Python: _______________
- Streamlit: _______________

### テスト結果
- Test 1: ⭕ / ❌
- Test 2: ⭕ / ❌
- Test 3: ⭕ / ❌
- Test 4: ⭕ / ❌
- Test 5: ⭕ / ❌

### 発見された問題
1. _______________
2. _______________
3. _______________

### 総合評価
セキュリティ実装: ✅ 合格 / ❌ 要修正

---

**注意**: このテストは手動での基本的な検証です。
本格的なペネトレーションテストは専門家に依頼することを推奨します。